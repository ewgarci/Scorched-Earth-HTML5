<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
	
	<title>Scorched Earth. HTML 5 JavaScript &amp; Canvas Game Clone</title>
	
	<!-- Meta Tags -->
	<meta http-equiv="content-type" content="application/xhtml+xml; charset=utf-8" />
	<meta name="robots" content="index, follow" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="author" content="" />

	<!-- Fav icon -->
	<link rel="shortcut icon" href="" />

	<!-- CSS -->
	<link rel="stylesheet" href="css/theme.css" media="screen,projection" type="text/css" />
	<link rel="stylesheet" href="" media="print" type="text/css" />

	<!--[if lte IE 6]>
		<link rel="stylesheet" href="css/ie6.css" media="screen,projection" type="text/css" />
	<![endif]-->
    
	</head>
	<body>
		<div id="container"> <!-- container. start -->
		    <h1 id="title">Scorched Earth</h1>
		    <h2 id="sub_title">A HTML and JavaScript &amp; Canvas Game Clone</h2>
		    
		    <noscript>
		        Please turn JavaScript on, thank-you.
		    </noscript>
		    
        <div id="canvas-container">
          <canvas id="game_board" width="640" height="480">
              You&rsquo;re browser doesn&rsquo;t support the &lt;canvas&gt; tag
          </canvas>
        </div>
			
			<div id="controls">
			    <h2>Controls</h2>

			    <p>
			        <div id="power_down" class="button">&lt;</div>
			        <div id="power_number" class="number">0</div>
			        <div id="power_up" class="button">&gt;</div>

			        <div id="angle_down" class="button">&lt;</div>
			        <div id="angle_number" class="number">0</div>
			        <div id="angle_up" class="button">&gt;</div>

			        <div id="fire_button" class="button">Fire</div>
			        <div id="switch_button" class="button">Switch Tanks</div>
              <br />

          </p>

			</div>
		</div><!-- container. end -->
		
		<!-- JavaScript  -->
    <script src="/socket.io/socket.io.js"></script>
		<script type="text/javascript" src="scripts/scorched_earth.js"></script>
    <script type="text/javascript">
        var socket = io.connect('http://localhost');
        var session = {};
        var localId = '';

        var angleChangeCb = function(angle) {
          socket.emit('angleUpdate', {
            id: localId,
            angle: angle
          });
        };

        var shotFiredCb = function(id, angle, power) {
          socket.emit('fireUpdate', {
            id: localId,
            angle: angle,
            power: power
          });
        };

        socket.on('session', function (data) {
          console.log(data);
          SEarth.setAngleChangeCb(angleChangeCb);
          SEarth.setShotFiredCb(shotFiredCb);
          session = data.session;
          localId = data.id;

          SEarth.updateFromSession(session);
          SEarth.selectTank(localId);
          //socket.emit('my other event', { my: 'data' });

          SEarth.drawSky();
          SEarth.drawLand(session.land);
          for (var t in session.tanks) {
            SEarth.drawTank(session.tanks[t]);
          }
          SEarth.addControls();
        });

        socket.on('misc', function (data) {
          console.log(data);
        });

        socket.on('sessionUpdate', function (data) {
          console.log(data);
          if (data.firedShots) {
            for (var id in data.firedShots) {
              if (id != localId) { 
                SEarth.updateTank(id,
                  data.firedShots[id].angle,
                  data.firedShots[id].power);

                SEarth.fireBullet(id);
              }
            }
          }

          if (data.angles) {
            for (var id in data.angles) {
              SEarth.updateTank(id, data.angles[id], null);
            }
          }
        });

        socket.on('addTank', function (data) {
          console.log('addTank ');
          console.log(data);
          session.tanks[data.id] = data.tank;
          SEarth.drawTank(data.tank);

          SEarth.updateFromSession(session);
        });

        socket.on('removeTank', function (data) {
          console.log('removeTank ');
          console.log(data);
          SEarth.removeTank(session.tanks[data.id]);
          delete session.tanks[data.id];

          SEarth.updateFromSession(session);
        });
    </script>

	</body>
</html>
